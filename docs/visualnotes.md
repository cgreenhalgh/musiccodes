# visual display notes

## functionality 

For climb! ...

- stage
- weather: (none) rain, snow, wind, storm, sun
- disklavier part
- musicode triggered

Using layered partially transparent video.

Using 16:9 aspect ratio (default HD 1280x720 30fps, square pixels)

Layer 0, "background": 
- mountain fill
- looped
- no (need to) transparency
- stage-specific 
- changed on stage load (auto)
- fade through black

Layer 1, "outline":
- mountain outline
- animated to visualise disclavier part
- default still image
- with transparency (alpha)
- shows video to completion 
- jump cut to default
- triggered by musicode starting disclavier part

Layer 2, "weather":
- video loops
- one per weather
- faded in/out
- triggered by random weather (delayed?!)
- also no weather

Layer 3, "muzicode":
- one-shot
- video or still image
- with transparency?
- configurable fade in/out?
- triggered by (selected) successful code

## author configuration

Spreadsheet:
- auto: v.background - background URL
- mcX: v.animation - disklav animation URL
- mcX: v.mc - 1 => use default, or muzicode success URL

Config file:
- per-weather loop URLs
- weather fade time
- outline default URL
- default muzicode image/video URL
- muzicode fade in time
- muzicode hold time
- muzicode fade out time
- background fade time
( weather delay time(s))

## client configuration

JSON configuration file - to minimise problems resulting from restarting the client (missed historical messages).

Root object:
- `@id`: urn:uuid ?!
- `title`: string
- `generated`: datetime
- `layers`: array of `Layer`s
- `preload`: array of URLs to preload

`Layer` object:
- `title`: string
- `channel`: string, channel name, default undefined
- `defaultUrl`: (optional)
- `loop`: boolean, default false
- `fadeIn`: number, seconds, default 0
- `faceOut`: number, seconds, default 0
- `transparent`: includes transparency? default true
- `holdTime`: number, seconds, default undefined = infinite (before fadeOut)
- `crossfade`: boolean, default false
- `insetTop`: fraction to inset top
- `insetRight`: fraction to inset top
- `insetBottom`: fraction to inset top
- `insetLeft`: fraction to inset top

 Generated by fast-performance-demo/scoretools/src/makemuzicodes.coffee.

The magic URL `video:...`, e.g. `video:true` or `video:{width:1280,height:720}` will attempt to show live video.

### musicode actions

Listens on channels:
- `v.background` - for background (layer 0) URL
- `v.animation` - for outline (layer 1)
- `v.weather` - for weather (layer 2)
- `v.muzicode` - for muzicode (layer 3)

## implementation...

Going with WebGL and Angular.js using layered video textures - see climbview.html

Video with transparency requires webM / VP8, e.g. using ffmpeg to encode.

### Notes

Angular.js see $animate

Tested [SVG](https://www.w3schools.com/graphics/svg_reference.asp) in `climbview-svg.html` - showing performance issues just from panning background image. 

## To do

- experience generator weather delays
- experience generator weather visual events
- mpmagent (browser) default to same server host as html page (for remote display)
- check musicodes server support for video file incremental loading
- climbview cross-site loading of videos??

test
```
http://localhost:3000/climbview.html#?config=%2Fassets%2Fclimbview-test.json&test
```
files, e.g.
```
/content/1bTheStonesBG_20secLoop.webm
/content/1bTheStonesDiskAni.webm
/content/baseCamp.jpg
```
